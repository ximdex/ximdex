// Generated by CoffeeScript 1.8.0
angular.module("ximdex.main.controller").controller("XTabsCtrl", [
  "$scope", "xTabs", "xUrlHelper", "$http", "$interval", "$sce", function($scope, xTabs, xUrlHelper, $http, $interval, $sce) {
    var reloadWelcomeTab;
    $scope.tabs = xTabs.getTabs();
    $scope.removeTab = xTabs.removeTab;
    $scope.setActiveTab = xTabs.setActive;
    $scope.closeAllTabs = xTabs.closeAll;
    $scope.offAllTabs = xTabs.offAll;
    $scope.getActiveIndex = xTabs.getActiveIndex;
    $scope.menuTabsEnabled = false;
    $scope.showingMenu = false;
    $scope.welcomeTab = "";
    reloadWelcomeTab = function() {
      $http.get(xUrlHelper.getAction({
        action: "welcome",
        nodes: [
          {
            nodeid: 10000
          }
        ]
      })).success(function(data) {
        if (data) {
          xTabs.loadCssAndJs(data);
          return $scope.welcomeTab = $sce.trustAsHtml(data);
        }
      });
    };
    reloadWelcomeTab();
    $interval(function() {
      if ($scope.tabs.length > 0) {
        return;
      }
      return reloadWelcomeTab();
    }, 15000);
    $scope.closeMenu = function() {
      $scope.showingMenu = false;
    };
    $scope.$watch('numberOfTabs', function(newValue, oldValue) {
      if (newValue === 0) {

      }
    });
    return $scope.$on("modifiedTabs", function() {
      var container, containerWidth, contents, contentsWidth, temp;
      temp = angular.element('#angular-content > .hbox-panel > .tabs-container');
      container = angular.element('#angular-content > .hbox-panel > .tabs-container > ul.ui-tabs-nav');
      containerWidth = temp.width();
      contents = angular.element('#angular-content > .hbox-panel > .tabs-container > ul.ui-tabs-nav > li');
      contentsWidth = 0;
      contents.each(function(index, element) {
        if (index === 0) {
          return;
        }
        return contentsWidth += angular.element(element).width() + 2;
      });
      if (containerWidth - 30 < contentsWidth) {
        container.css("left", (containerWidth - contentsWidth - 30) + "px");
        return $scope.menuTabsEnabled = true;
      } else {
        container.css("left", "0px");
        return $scope.menuTabsEnabled = false;
      }
    });
  }
]);
